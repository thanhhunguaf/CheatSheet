<html>

<!-- Mirrored from thefullsnack.com/posts/rust-for-the-web.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 May 2020 03:20:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf8" /><!-- /Added by HTTrack -->
<head>
<title>Rust và Lập trình Web | Huy's Blog</title>
<meta charset="utf-8">
<meta http-equiv="content-type" content="text/html;"><meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
<meta property='og:image' content='../img/default.jpg'>
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../manifest.json">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">
<link href="../css/theme.dist.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../emoji/css/emoji.dist.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Space+Mono:400,700&amp;display=swap&amp;subset=vietnamese" rel="stylesheet">

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92158965-1"></script>
<script>
	       window.dataLayer = window.dataLayer || [];
	       function gtag(){dataLayer.push(arguments);}
	       gtag('js', new Date());

	       gtag('config', 'UA-92158965-1');
	      </script>
</head>
<body lang="en" class="post">
<div class="header lightweight-theme">
<a href="../index.html"><span class="avatar"></span></a>
</div>
<div class="container">
<div class="main">
<h1><span>Rust và Lập trình Web</span></h1>
<p>Bài viết được dịch lại từ bản gốc <a href="../en/rust-for-the-web.html">&quot;Rust for the Web&quot;</a> đăng tại phiên bản blog tiếng Anh của mình.</p>
<hr />
<p><em>&quot;Rust có làm được Web không nhỉ?&quot;</em> - Đây là câu hỏi của rất nhiều người, trong đó có mình.</p>
<p>Một trong những mục tiêu được đặt ra khi mình bắt đầu học Rust đó chính là <strong>sử dụng Rust để làm web apps</strong>.</p>
<p>Và sau gần 1 năm thì mình cũng học được vài thứ. Vì thế mình viết bài này để chia sẽ lại kinh nghiệm <strong>Làm web với Rust</strong> của mình.</p>
<p>Có rất nhiều phương pháp để làm web dùng Rust, ví dụ như là, compile Rust code ra thành client-side JavaScript code dùng WebAssembly, viết RESTful API, hoặc xây dựng ứng dụng web được render từ phía server, giống như những năm 2012 vậy :v</p>
<p>Chúng ta sẽ đi vào từng phương pháp một.</p>
<h2><a href="#client-side-javascript-trong-rust" aria-hidden="true" class="anchor" id="client-side-javascript-trong-rust"></a>Client-side JavaScript trong Rust</h2>
<p>Cách đầu tiên, hoàn toàn là frontend, mà mình nghiên cứu đó là dùng Rust để viết web theo dạng component-based như là React vậy. Điều này có nghĩa là chúng ta phải tìm ra cách nào đó để chạy Rust ngay trên trình duyệt.</p>
<p>Và tất nhiên không phải tìm lâu, chúng ta có thể <a href="https://users.rust-lang.org/t/compiling-to-the-web-with-rust-and-emscripten/7627">dễ dàng biên dịch code Rust ra thành JavaScript</a> để chạy trên trình duyệt, nhờ vào các dự án như ASM.js và WebAssembly.</p>
<p>Rồi, giờ quay lại vụ component-based. Mình có viết một macro đơn giản để wrap các API của crate <a href="https://crates.io/crates/stdweb">stdweb</a>, và render các HTML elements thông qua DOM API của trình duyệt:</p>
<p><a href="https://github.com/huytd/rust-webapp-template/blob/master/src/main.rs#L13-L58">https://github.com/huytd/rust-webapp-template/blob/master/src/main.rs#L13-L58</a></p>
<p>Nếu mà nhìn vào đoạn code trên bạn cảm thấy mông lung không hiểu gì, thì thôi cũng đừng hoảng. Cú pháp macro của Rust vốn không được đẹp cho lắm. Mà thực ra giờ mình đọc lại cũng không hiểu mình đang viết gì nữa, tự thấy nể bản thân mình ghê gớm =)))</p>
<p>Chi tiết về đoạn macro trên, <code>component!</code> làm nhiệm vụ định nghĩa ra một HTML element mới, <code>mount_component!</code> làm nhiệm vụ chèn (append) cái element đó vào document, và <code>html!</code> làm nhiệm vụ tạo ra một element từ một chuỗi HTML bất kỳ.</p>
<p>Cách dùng như sau:</p>
<pre><code class="language-rust">component!(AppComponent =&gt; {
    init: {
        let e: Element = html!(&quot;
        &lt;div&gt;
            &lt;p&gt;
                &lt;span&gt;Hello&lt;/span&gt;
                &lt;span&gt;World&lt;/span&gt;
            &lt;/p&gt;
            &lt;GreenButton /&gt;
        &lt;/div&gt;
        &quot;);

        let mut button = GreenButton::new();
        mount_component!(e, &quot;GreenButton&quot;, button);

        e
    },
    render: |this: &amp;Element| {
    }
});

component!(GreenButton =&gt; {
    init: {
        let button = document().create_element(&quot;button&quot;);
        button.add_event_listener(move |_: ClickEvent| {
            js! {
                alert(&quot;Yo! This is the Green Button!&quot;);
            }
        });
        button
    },
    render: |this: &amp;Element| {
        this.set_text_content(&quot;This is a button&quot;);
    }
});

fn main() {
    stdweb::initialize();

    let mut app = AppComponent::new();
    mount_component!(document(), &quot;#root&quot;, app);

    stdweb::event_loop();
}
</code></pre>
<p>Đấy, như thế thì ai cần xài React làm gì nữa nào? =))) (đùa tí thôi)</p>
<p><img src="img/rust-wasm-web.jpg" alt="" /></p>
<p>Các bạn có thể tham khảo <a href="https://github.com/huytd/rust-webapp-template">mã nguồn đầy đủ</a> để xem cách sử dụng <code>stdweb</code> với các macro trên để minh họa cho phương pháp <strong>biên dịch Rust sang JavaScript</strong>.</p>
<h2><a href="#dùng-rust-viết-restful-api" aria-hidden="true" class="anchor" id="dùng-rust-viết-restful-api"></a>Dùng Rust viết RESTful API</h2>
<p>Phương pháp thứ 2 tập trung vào backend. Đó là dùng Rust để viết một API server và kết nối nó với frontend có sẵn của bạn.</p>
<p>Hiện tại có một lượng kha khá framework để bạn chọn, có thể tham khảo tại <a href="https://www.arewewebyet.org/">AreWeWebYet</a>.</p>
<p>Với những ai thích xài các framework nhỏ gọn <a href="https://crates.io/crates/tiny_http">tiny_http</a> là sự lựa chọn hoàn hảo.</p>
<p>Xét về mặt đơn giản, dễ dùng thì <a href="https://github.com/nickel-org/nickel.rs">nickel.rs</a>, là một trong những framework tinh gọn nhất trong Rust, và lấy cảm hứng từ Express framework bên Node.js</p>
<p>Nếu bạn muốn hỗ trợ HTTP/2, thì <a href="https://github.com/mlalic/solicit">solicit</a> là sự lựa chọn duy nhất tính tới thời điểm này.</p>
<p>Cá nhân mình thích xài <a href="https://rocket.rs/">rocket.rs</a> vì nó là một framework rất mạnh và có rất nhiều tính năng, nhưng vẫn giữ cho code của bạn đơn giản tới mức tối đa. Gần đây thì rocket.rs đã hỗ trợ luôn TLS built-in. Điểm trừ duy nhất của framework này đó là cần sử dụng phiên bản Rust Nightly.</p>
<p>Đây là đoạn code ví dụ việc handle một endpoint dùng <code>GET</code> method với rocket.rs:</p>
<pre><code class="language-rust">[get(&quot;/posts&quot;, format = &quot;application/json&quot;)]
fn get_posts(page: i64) -&gt; Json&lt;Value&gt; {
    Json(json!({
        &quot;result&quot;: []
    }))
}
</code></pre>
<p>Bên cạnh việc serve API, mình thường dùng rocket.rs để serve static files luôn, giống như khi xài Express:</p>
<pre><code class="language-rust">#[get(&quot;/&quot;)]
fn index() -&gt; io::Result&lt;NamedFile&gt; {
    NamedFile::open(&quot;www/index.html&quot;)
}

#[get(&quot;/&lt;file..&gt;&quot;, rank = 5)]
fn files(file: PathBuf) -&gt; Option&lt;NamedFile&gt; {
    NamedFile::open(Path::new(&quot;www/&quot;).join(file)).ok()
}
</code></pre>
<p>Từ đây thì mình có thể đưa hết toàn bộ code frontend vào một thư mục, ví dụ như là <code>www</code>, và gọi tới RESTful API từ Rust. Để rõ hơn thì đây là ví dụ minh họa về cấu trúc của mộ project mà mình thường làm:</p>
<pre><code>├── Cargo.toml
├── README.md
├── src
│   ├── main.rs
│   └── ...Rust code here...
└── www
    ├── index.html
    ├── main.js
    ├── package.json
    ├── webpack.config.js
    └── ...JavaScript code here...
</code></pre>
<p>Để kết nối với database, chúng ta có thể sử dụng các ORM như <a href="https://diesel.rs/">Diesel</a>.</p>
<p>Nếu bạn muốn tham khảo ví dụ thực tế về 1 project sử dụng <code>rocket.rs</code> + <code>Diesel</code> (cho backend) và <code>React</code> (cho frontend), thì <a href="https://github.com/huytd/codedaily-v3">đây là mã nguồn</a> của <a href="https://news.kipalog.com/">Kipalog Links</a> - website đọc/tổng hợp tin bài từ các blogger công nghệ tiếng Việt mình làm cho <a href="https://kipalog.com/">Kipalog</a>.</p>
<p><img src="img/rust-kipalog.png" alt="" /></p>
<p><em>Gửi mail cho mình link RSS blog của bạn nếu bạn muốn bài viết của mình được list trên Kipalog Links :P</em></p>
<h2><a href="#server-side-rendering-với-rust" aria-hidden="true" class="anchor" id="server-side-rendering-với-rust"></a>Server-side rendering với Rust</h2>
<p>Phương pháp cuối cùng, là phương pháp mình thích nhất, giống với thời kì nằm 2012, khi mình mới bắt đầu sự nghiệp lập trình với một chân code thuê PHP. :))</p>
<p>Không còn những khái niệm Single Page Application, client-side rendering. Không còn những trang web bể tè le hột me khi <a href="https://www.quora.com/Why-do-some-people-disable-JavaScript-in-their-browser">người dùng disable JavaScript</a> nữa.</p>
<p><em>Fun fact: Hầu hết các website lớn đều hoạt động ngay cả khi bạn tắt JavaScript của trình duyệt</em></p>
<p>Cũng như nhiều framework đến từ các ngôn ngữ khác (như Rails, CakePHP, ASP.NET...), rocket.rs hỗ trợ bạn render một HTML template sau khi đã bind dữ liệu vào đó từ phía server, trình duyệt chỉ cần nhận về và hiển thị lên màn hình.</p>
<pre><code class="language-rust">#[get(&quot;/&quot;)]
fn index() -&gt; Template {
    let news = fetch_from(RSS_URL).ok().expect(&quot;Could not read RSS&quot;);
    Template::render(&quot;index&quot;, &amp;news)
}
</code></pre>
<p>Ở <a href="making-rust-hackernews.html">bài viết trước</a>, mình hướng dẫn cách build một ứng dụng đọc tin Hacker News dùng rocket.rs và Handlebars template, chính là áp dụng phương pháp này.</p>
<p><img src="img/rust-hackernews.png" alt="" /></p>
<p>Các bạn có thể tham khảo <a href="https://github.com/huytd/hackernews-rss-reader">mã nguồn đầy đủ của project</a> để nắm rõ hơn. Phiên bản code trong mã nguồn này có áp dụng một vài kĩ thuật mới chưa được đề cập trong bài trước để giải quyết vấn đề load nội dung qua giao thức HTTPS.</p>
<hr />
<p>Vậy là chúng ta đã điểm qua hết các phương pháp sử dụng Rust vào cho một project Web. Mỗi một phương pháp trên đều có những ưu nhược điểm khác nhau, có thể sử dụng tùy theo từng yêu cầu khác nhau của mỗi dự án, và bạn cũng hoàn toàn có thể kết hợp các phương pháp này lại với nhau trong cùng một dự án.</p>
<p>Hy vọng qua bài viết này, các bạn có được cái nhìn toàn cảnh về việc lập trình Web với Rust, và có được câu trả lời của riêng mình cho câu hỏi: <em>&quot;Rust có làm được Web không?&quot;</em>.</p>
<p>Và chúc các bạn may mắn nếu quyết định sử dụng Rust vào cho project của mình.</p>
<p>Happy Rusting...</p>
<div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='../tags/rust.html'>rust</a><a class='topic-tag' href='../tags/code.html'>code</a></div>
<div class="related-posts" style="margin-top: 15px; border-bottom: 1px solid #eee;">
<p><i class="em em-sun_with_face"></i> Cảm ơn bạn đã theo dõi bài viết! các bạn có thể <a href="https://facebook.com/thefullsnackblog" target="_blank">follow mình trên Facebook</a> để đặt câu hỏi, hoặc nhận thông tin về các bài viết mới.</p>
</div>
<div class="comments">
<ul id="comment-list" class="comment-list"></ul>
<div id="login-box" class="login">
Bạn nghĩ như thế nào về bài viết này?<br /><button onclick="login()">Tham gia bình luận</button>
<div class="copyright">Chức năng này cần liên kết với tài khoản Google<br />Nếu không thích thì có thể comment <button onclick="goninja()">Nặc danh</button></div>
</div>
<div id="comment-box" class="comment-input">
<div class="avatar">
<img id="user-avatar" src="#" width="32" height="32" />
</div>
<div class="input">
<textarea id="comment-content" onkeydown="submitComment(event)" placeholder="Comment gõ vào đây :D"></textarea>
<span>Gõ xong nhấn <kbd>Ctrl</kbd> + <kbd>Enter</kbd> để gửi. Bạn không thể xóa comment sau khi gửi.</span>
<button id="comment-button" onclick="submitData()">Gửi</button>
</div>
</div>
</div>
</div>
</div>
<div class="footer lightweight-theme">
<p>you're free to use the content on this blog for whatever you want</p>
<p>Created with <i class="em em-coffee"></i> <a href="https://github.com/huytd/ristretto-rs">ristretto.rs</a></p>
</div>
<script src="../js/highlight.pack.js"></script>
<script>
        </script>
<script type="text/javascript" async src="../../cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJaxb198.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
         MathJax.Hub.Config({
             tex2jax: {
                 inlineMath: [['$','$'], ['\\(','\\)']],
                 skipTags: ["script","noscript","style","textarea", "code"],
                 ignoreClass: "tex2jax_ignore|comment|comment-list|content"
             }
         });
        </script>
<script src="../js/toc.js"></script>
<script src="../../www.gstatic.com/firebasejs/3.8.0/firebase.js"></script>
<script>
         let postCommentURL = '../api/post/rust-for-the-web.json';
         // Initialize Firebase
         var config = {
             apiKey: "AIzaSyA1PnIAlJJ-U6iQJMNnCOknBuziBqGMYcY",
             authDomain: "huys-blog-comment.firebaseapp.com",
             databaseURL: "https://huys-blog-comment.firebaseio.com",
             projectId: "huys-blog-comment",
             storageBucket: "huys-blog-comment.appspot.com",
             messagingSenderId: "317330376829"
         };

         var login = function() {
             window.auth.signInWithPopup(provider)
                   .then(function(result) {
                   }).catch(function(err) {
                   });
         };

         var goninja = function() {
             updateAuth({
                 displayName: "Không Tên",
                 photoURL: "https://thefullsnack.com/img/kaonashi.jpg"
             });
         };

         var updateAuth = function(user) {
             if (user) {
                 currentUser = user;
                 // Logged in
                 document.getElementById("login-box").style.display = "none";
                 document.getElementById("comment-box").style.display = "flex";
                 document.getElementById("user-avatar").setAttribute("src", user.photoURL + "?sz=32");
             } else {
                 // Not login yet
                 document.getElementById("comment-box").style.display = "none";
                 document.getElementById("login-box").style.display = "block";
             }
         };

         var encodeHTML = function(s) {
             return s.replace(/</g, '&lt;').replace(/"/g, '&quot;').replace(/>/g, '&gt;');
         };

         var saveNewComment = function(comment) {
             if (!currentUser) {
                 return;
             }
             var commentData = {
                 username: currentUser.displayName,
                 avatar: currentUser.photoURL,
                 post_time: ~~((new Date()).getTime() / 1000),
                 message: encodeHTML(comment)
             };

             fetch(postCommentURL, {
                 method: 'post',
                 headers: {
                     "Content-Type": "application/json"
                 },
                 body: JSON.stringify(commentData)
             }).then((result) => {
                 if (result.status === 200) {
                     addNewComment(commentData.username, commentData.avatar, commentData.post_time, commentData.message);
                 }
             });

             document.getElementById("comment-content").value = "";
         };

         function debounce(func, wait, immediate) {
             var timeout;
             return function() {
                 var context = this, args = arguments;
                 var later = function() {
                     timeout = null;
                     if (!immediate) func.apply(context, args);
                 };
                 var callNow = immediate && !timeout;
                 clearTimeout(timeout);
                 timeout = setTimeout(later, wait);
                 if (callNow) func.apply(context, args);
             };
         };

         var submitData = debounce(function() {
             var comment = document.getElementById("comment-content").value;
             if (comment.length) {
                 saveNewComment(comment);
             }
         }, 250);

         var submitComment = function(e) {
             var keyCode = e.which || e.keyCode;
             var ctrlCode = e.ctrlKey || e.metaKey;
             if (keyCode === 13 && ctrlCode) {
                 submitData();
             }
         };

         var filterNewlineInComment = function(t) {
             return t.replace(/\n/g, "<br/>");
         };

         var filterURLinComment = function(comment) {
             return comment.replace(/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9]\.[^\s]{2,})/g, "<a target='_blank' rel='noopener noreferrer' href='$1'>$1</a>");
         };

         var addNewComment = function(user, avatar, time, comment, first) {
             var commentFiltered = encodeHTML(comment);
             commentFiltered = filterNewlineInComment(filterURLinComment(commentFiltered));
             commentFiltered = commentFiltered.replace(/```/g, '');
             var d = new Date(time * 1000);
             var commentTime = d.toLocaleTimeString() + ' ' + d.toLocaleDateString();
             var anoNameClass = (avatar.indexOf('thefullsnack.com') !== -1) ? "grey" : "";
             var html = '<div class="avatar">' +
                        '   <img src="' + avatar + '?sz=32" width="32" height="32"/>' +
                        ' </div>' +
                        '<div class="comment">' +
                        '  <div class="metadata"><b class="' + anoNameClass + '">' + encodeHTML(user) + '</b> lúc <span>' + commentTime + '</span></div>' +
                        '  <div class="content tex2jax_ignore">' + commentFiltered
             '  </div>' +
                        '</div>';
             var li = document.createElement('li');
             li.innerHTML = html;
             if (!first) {
                 document.getElementById("comment-list").append(li);
             } else {
                 let elm = document.getElementById("comment-list");
                 elm.insertBefore(li, elm.firstChild);
             }
         };



         window.onload = function() {

             document.querySelectorAll("pre code").forEach(el => {
                 hljs.highlightBlock(el);
             });

             start_toc_module();

             firebase.initializeApp(config);
             window.provider = new firebase.auth.GoogleAuthProvider();
             window.auth = firebase.auth();
             window.currentUser = null;

             window.auth.onAuthStateChanged(function(user) {
                 updateAuth(user);
             });


             // Fetch comment and put to posts
             fetch(postCommentURL)
                 .then(res => res.json())
                 .then(data => {
                     if (data.comments) {
                         let comments = data.comments;
                         comments.sort((a, b) => a.post_time - b.post_time);
                         for (let i = 0; i < comments.length; i++) {
                             let cmt = comments[i];
                             addNewComment(cmt.username, cmt.avatar, cmt.post_time, cmt.message);
                         }
                     }
                 });
         };

         var toggle_wordwise = function(status) {
             var book = document.querySelector("book");
             var on = document.querySelector("#ww_on");
             var off = document.querySelector("#ww_off");
             if (!status) {
                 book.className = "off";
                 on.className = "btn-toggle";
                 off.className = "btn-toggle active";
             } else {
                 book.className = "";
                 on.className = "btn-toggle active";
                 off.className = "btn-toggle";
             }
         };
        </script>
</body>

<!-- Mirrored from thefullsnack.com/posts/rust-for-the-web.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 May 2020 03:20:04 GMT -->
</html>
