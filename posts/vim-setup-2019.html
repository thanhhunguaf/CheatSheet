<html>

<!-- Mirrored from thefullsnack.com/posts/vim-setup-2019.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 May 2020 03:19:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf8" /><!-- /Added by HTTrack -->
<head>
<title>2019 rồi, setup Vim như nào? | Huy's Blog</title>
<meta charset="utf-8">
<meta http-equiv="content-type" content="text/html;"><meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
<meta property='og:image' content='img/vim-acejump.gif'>
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../manifest.json">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">
<link href="../css/theme.dist.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../emoji/css/emoji.dist.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Space+Mono:400,700&amp;display=swap&amp;subset=vietnamese" rel="stylesheet">

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92158965-1"></script>
<script>
	       window.dataLayer = window.dataLayer || [];
	       function gtag(){dataLayer.push(arguments);}
	       gtag('js', new Date());

	       gtag('config', 'UA-92158965-1');
	      </script>
</head>
<body lang="en" class="post">
<div class="header lightweight-theme">
<a href="../index.html"><span class="avatar"></span></a>
</div>
<div class="container">
<div class="main">
<h1><span>2019 rồi, setup Vim như nào?</span></h1>
<p><strong>Lưu ý:</strong> Bài viết này không dành cho những bạn chưa biết gì về Vim, nếu bạn chưa biết xài Vim, không sao, hãy dành ra <a href="https://kipalog.com/posts/Lam-quen-VIM-trong-5-phut">5 phút để làm quen</a> với nó và thêm 10 phút nữa để <a href="https://kipalog.com/posts/Di-cu-tu-Sublime-Text-sang-VIM">học cách cấu hình nó</a>, xong rồi hãy quay lại đọc bài này <i class='em em-smirk'></i>.</p>
<hr />
<p>Sau gần 2 năm xài Emacs thì giờ mình đã quay trở lại xài Vim, chính xác là Neovim.</p>
<h2><a href="#lời-tự-thú-của-một-traitor" aria-hidden="true" class="anchor" id="lời-tự-thú-của-một-traitor"></a>Lời tự thú của một traitor</h2>
<p><img src="img/vim-traitor.png" alt="" /></p>
<div class="center copyright">Tên của các nhân vật trong bài chưa được thay đổi</div>
<p>Lý do? Rất đơn giản, vì Emacs quá xịn và có quá nhiều chức năng, khả năng mở rộng quá tuyệt vời, nên mình tốn quá nhiều thời gian vào việc ngồi customize cho nó, thay vì ngồi làm những việc mình cần phải làm <i class='em em-joy'></i>.</p>
<p>Đùa vui tí, thực ra nguyên nhân sâu xa hơn thế. Lý do lớn nhất khiến mình chuyển từ Vim sang Emacs đó là, nó có GUI mode, đem tới khả năng hiển thị các ứng dụng trên môi trường đồ họa tốt hơn như là browser, terminal tích hợp tốt hơn nên mình hy vọng phần nào nó sẽ cải thiện được quy trình làm việc của mình. Sau 2 năm sử dụng, thì những thứ mình kỳ vọng hóa ra nó không thực sự hoàn hảo, GUI client trên macOS quá tệ đem lại trải nghiệm không được tốt cho lắm. Phải chi mình xài Linux toàn thời gian thì đã khác.</p>
<p>Sau khi dẹp Emacs thì mình qua xài VSCode vì nó có vẻ là editor cực kì xịn, ngay cả khi chưa cần config gì nhiều, và mình cũng kịp publish được <a href="https://marketplace.visualstudio.com/items?itemName=huytd.vscode-diff">hai</a> <a href="https://marketplace.visualstudio.com/items?itemName=huytd.searchy-fuzzy">cái</a> plugin trước khi dẹp luôn nó qua một bên, vì cái máy tính mình xài cũng không chịu nổi chuyện chạy nguyên cái trình duyệt Chromium cho mỗi cửa sổ gõ code.</p>
<p>Vừa hay đúng thời điểm này thì <a href="https://github.com/neovim/neovim/commit/e2cc5fe09d98ce1ccaaa666a835c896805ccc196">Neovim release phiên bản 0.4.0</a>, có thể coi đây là phiên bản được mong đợi nhất vì có khá nhiều update quan trọng, như <code>lua-stdlib</code>, hay một loạt các cải tiến về UI, và quan trọng nhất là hỗ trợ <code>floating window</code> -- một tính năng xưa như trái đất ở các GUI-based editor nhưng là dấu mốc quan trọng của Neovim -- giúp hiển thị popup chứa nội dung, như là document cho một function, hay type signature của một giá trị.</p>
<p><img src="img/vim-floating-window.png" alt="" /></p>
<p>Với chức năng này, thì chúng ta có thể dễ dàng cấu hình cho Vim (hoặc Neovim) để đem lại trải nghiệm không thua gì VSCode. Sau đây mình sẽ giới thiệu về cách mình config Vim để sử dụng cho công việc hằng ngày. Và không có lý do gì để mình không quay lại Vim nữa.</p>
<h2><a href="#vim-chạy-trong-terminal-lag-thấy-bà" aria-hidden="true" class="anchor" id="vim-chạy-trong-terminal-lag-thấy-bà"></a>Vim chạy trong terminal, lag thấy bà</h2>
<p>Hẳn là bạn đang xài một cái terminal emulator cùi bắp, kiểu như <code>Apple Terminal</code> hoặc tệ hơn là <code>iTerm 2</code>.</p>
<p>Nếu quả đúng là như thế, thì các bạn có thể thử <a href="https://github.com/jwilm/alacritty">Alacritty</a>, một terminal emulator viết bằng Rust và render bằng GPU, nó hơi ngốn pin một tí nhưng tin mình đi, nó đem lại trải nghiệm cực kì tốt.</p>
<p><code>iTerm 2</code> nghe đồn cũng đã có GPU rendering, nhưng mà Alacritty dễ config hơn, vả lại nó còn cross platform, cho nên nếu cần thì mình vẫn có thể bê nguyên cái setup này qua Linux mà không phải đắn đo suy nghĩ.</p>
<h2><a href="#language-server-protocol-lsp)-và-neovim" aria-hidden="true" class="anchor" id="language-server-protocol-lsp)-và-neovim"></a>Language Server Protocol (LSP) và Neovim</h2>
<p>Trong trường hợp bạn không biết, thì lý do khiến VSCode trở nên phổ biến, đặc biệt là với các lập trình viên JavaScript/TypeScript đó là nhờ khả năng support với nhiều ngôn ngữ lập trình cực kì hiệu quả, hay nói cách khác là nhờ nó tích hợp một cái <a href="https://microsoft.github.io/language-server-protocol/">LSP</a> client cực kì xịn.</p>
<p>Điều này khá là dễ hiểu, vì cả LSP lẫn VSCode đều được làm ra bởi Microsoft, mặc dù là 2 team khác nhau.</p>
<p>Nói về LSP, nó là phương thức giúp cho các code editor có thể giao tiếp với các <code>language server</code> -- là các ứng dụng hỗ trợ cho các code editor thực hiện các chức năng như auto complete, go to definition, hiển thị document hay type signature.</p>
<p>Và hầu hết các editor hiện có đều đã có LSP client của riêng nó. Tất nhiên Vim/Neovim cũng có.</p>
<p>Sau khi thử nghiệm một vài LSP client khác nhau cho Neovim, thì mình quyết định sẽ chọn <a href="https://github.com/neoclide/coc.nvim">coc.nvim</a>, khi mà bản thân nó vừa là LSP Client, vừa cung cấp chức năng auto complete, và thế là mình khỏi phải cài <code>deoplete</code> hay <code>YouCompleteMe</code> luôn.</p>
<p>Thêm nữa, <code>coc.nvim</code> đã support floating window của Neovim 0.4.0, chính vì thế, về mặt UI thì bạn hoàn toàn yên tâm, không thua gì VSCode.</p>
<p>Bên cạnh chức năng cơ bản của LSP client như auto complete, go to definition, find references, <code>coc.nvim</code> còn cung cấp nhiều tính năng khá là hữu ích khác như nhảy nhanh tới một symbol/function trong file source (giống như <code>Go to Symbol</code> của VSCode hay Sublime):</p>
<pre><code>&quot; Press Ctrl + O to jump to a symbol
nnoremap &lt;C-o&gt; :CocList outline&lt;CR&gt;
</code></pre>
<p>Hoặc một tính năng khác khá hay ho đó là thêm định nghĩa cho function text object của Vim, nếu bạn từng dùng các tổ hợp phím <code>i)</code>, <code>i&quot;</code> hay <code>aw</code> (thao tác với nội dung bên trong các cặp dấu nháy <code>()</code>, hay <code>&quot;&quot;</code> hay trên một từ, đoạn văn), thì giờ đây chúng ta còn có <code>if</code> và <code>af</code> để thao tác trên một function:</p>
<pre><code>&quot; Create mappings for function text object, requires
&quot; document symbols feature of languageserver.
xmap if &lt;Plug&gt;(coc-funcobj-i)
xmap af &lt;Plug&gt;(coc-funcobj-a)
omap if &lt;Plug&gt;(coc-funcobj-i)
omap af &lt;Plug&gt;(coc-funcobj-a)
</code></pre>
<p>Ngoài mấy cái này ra, bạn có thể copy cấu hình mặc định được cung cấp trong file README của <code>coc.nvim</code>.</p>
<p>Khi cài xong, đừng quên chạy lệnh cài các gói language bạn cần, ví dụ mình thường code JavaScript/TypeScript và Rust, nên sẽ cài <code>coc-tsserver</code> và <code>coc-rls</code>:</p>
<pre><code>:CocInstall coc-tsserver
:CocInstall coc-rls
</code></pre>
<h2><a href="#tích-hợp-git-trong-vim" aria-hidden="true" class="anchor" id="tích-hợp-git-trong-vim"></a>Tích hợp Git trong Vim</h2>
<p>Khi không dùng Emacs nữa thì tính năng mình nhớ nhất của nó là tích hợp Git, nếu đã từng xài <code>Magit</code> của Emacs thì bạn sẽ biết nó lợi hại đến thế nào.</p>
<p>Trong Vim, chúng ta có <a href="https://github.com/tpope/vim-fugitive">fugitive.vim</a>, mặc dù không bằng Magit của Emacs, nhưng bạn vẫn có thể thực hiện các thao tác xem git status, stage hoặc commit từng đoạn (hunk), push code ngay trên Vim.</p>
<img src="img/vim-magit.png" style="max-width: 800px; margin-left: -140px" />
<p>Ví dụ như hình trên là màn hình <code>:Gstatus</code> của <code>fugitive.vim</code>, hiển thị 3 đoạn thay đổi trong file <code>src/lspc.rs</code>, trong đó có 1 đoạn đã được staged.</p>
<h2><a href="#terminal-tích-hợp" aria-hidden="true" class="anchor" id="terminal-tích-hợp"></a>Terminal tích hợp</h2>
<p>Một thói quen mà mình bị nhiễm khi sử dụng Emacs và VSCode đó là thường xuyên mở một cửa sổ terminal mới từ ngay bên trong editor, chỉ bởi vì 2 editor này có terminal emulator khá tốt.</p>
<p>Còn terminal emulator trong Vim/Neovim thì tệ hết chỗ nói. Cho nên giải pháp của mình là xài <code>tmux</code>, hoặc lúc nào lười tạo một window mới trong <code>tmux</code>, thì mình làm như sau:</p>
<ul>
<li>Bấm <code>Ctrl + Z</code> để tạm dừng Vim, đưa nó thành một background process.</li>
<li>Lúc này terminal đã trống, có thể làm gì với nó tùy thích, thậm chí có thể <code>cd</code> ra ngoài thư mục khác.</li>
<li>Khi cần quay lại Vim, gõ <code>fg</code> để khôi phục nó thành process đang chạy.</li>
</ul>
<h2><a href="#di-chuyển-nhanh-hơn" aria-hidden="true" class="anchor" id="di-chuyển-nhanh-hơn"></a>Di chuyển nhanh hơn</h2>
<p>Một căn bệnh mà mình bị nhiễm từ trước khi bỏ Vim qua xài Emacs, đó là bò từ dòng này sang dòng khác, từng dòng một, tương tự với việc di chuyển từ kí tự này sang kí tự khác trên 1 dòng. Việc này mất khá nhiều thời gian, là những động tác thừa không cần thiết, đôi khi còn gây mất tập trung.</p>
<p>Một giải pháp đó là sử dụng <a href="https://github.com/easymotion/vim-easymotion">vim-easymotion</a>, giúp chúng ta nhảy nhanh đến một từ hoặc một kí tự trên màn hình:</p>
<img src="img/vim-acejump.gif" style="max-width: 800px; margin-left: -140px" />
<p>Ở ví dụ trên, mình thực hiện lệnh nhảy đến một kí tự trên màn hình, bằng tổ hợp phím <code>;;</code>, được cấu hình như sau:</p>
<pre><code>&quot; Vim easymotion
nmap &lt;silent&gt; ;; &lt;Plug&gt;(easymotion-overwin-f)
nmap &lt;silent&gt; ;l &lt;Plug&gt;(easymotion-overwin-line)
</code></pre>
<p>Ngoài ra, lệnh nhảy tới/lui đến một kí tự trong cùng một dòng, dùng <code>f&lt;kí tự&gt;</code> và <code>F&lt;kí tự&gt;</code> cũng sẽ khá hữu ích và giúp tiết kiệm thời gian.</p>
<hr />
<p>Trên đây là một vài dòng giới thiệu ngắn về những gì mình sử dụng cho Vim. Thực ra viết tới đây rồi thì mình không biết phải kết bài như nào cho nó hay, nên thôi cứ kết bà nó luôn.</p>
<p>Nếu quan tâm, các bạn có thể sử dụng vim config của mình tại đây <a href="https://github.com/huytd/vim-config">https://github.com/huytd/vim-config</a></p>
<p>Có hai cách để sử dụng <code>vim-config</code> trên của mình:</p>
<ol>
<li>Xem file <code>init.vim</code> và copy phần nào bạn thích</li>
<li>Nếu lười, bạn có thể clone toàn bộ repo về thư mục <code>~/.config/nvim</code>, và make sure bạn đã backup thư mục <code>nvim</code> của bạn trước khi làm điều này, như sau (nhớ đọc kĩ từng dòng lệnh, hãy hành động có trách nhiệm <i class='em em-joy'></i>)</li>
</ol>
<pre><code>$ cp -rf ~/.config/nvim/ ~/.config/backup.nvim/
$ rm -rf ~/.config/nvim
$ git clone https://github.com/huytd/vim-config ~/.config/nvim/
</code></pre>
<div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='../tags/vim.html'>vim</a><a class='topic-tag' href='../tags/emacs.html'>emacs</a></div>
<div class="related-posts" style="margin-top: 15px; border-bottom: 1px solid #eee;">
<p><i class="em em-sun_with_face"></i> Cảm ơn bạn đã theo dõi bài viết! các bạn có thể <a href="https://facebook.com/thefullsnackblog" target="_blank">follow mình trên Facebook</a> để đặt câu hỏi, hoặc nhận thông tin về các bài viết mới.</p>
</div>
<div class="comments">
<ul id="comment-list" class="comment-list"></ul>
<div id="login-box" class="login">
Bạn nghĩ như thế nào về bài viết này?<br /><button onclick="login()">Tham gia bình luận</button>
<div class="copyright">Chức năng này cần liên kết với tài khoản Google<br />Nếu không thích thì có thể comment <button onclick="goninja()">Nặc danh</button></div>
</div>
<div id="comment-box" class="comment-input">
<div class="avatar">
<img id="user-avatar" src="#" width="32" height="32" />
</div>
<div class="input">
<textarea id="comment-content" onkeydown="submitComment(event)" placeholder="Comment gõ vào đây :D"></textarea>
<span>Gõ xong nhấn <kbd>Ctrl</kbd> + <kbd>Enter</kbd> để gửi. Bạn không thể xóa comment sau khi gửi.</span>
<button id="comment-button" onclick="submitData()">Gửi</button>
</div>
</div>
</div>
</div>
</div>
<div class="footer lightweight-theme">
<p>you're free to use the content on this blog for whatever you want</p>
<p>Created with <i class="em em-coffee"></i> <a href="https://github.com/huytd/ristretto-rs">ristretto.rs</a></p>
</div>
<script src="../js/highlight.pack.js"></script>
<script>
        </script>
<script type="text/javascript" async src="../../cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJaxb198.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
         MathJax.Hub.Config({
             tex2jax: {
                 inlineMath: [['$','$'], ['\\(','\\)']],
                 skipTags: ["script","noscript","style","textarea", "code"],
                 ignoreClass: "tex2jax_ignore|comment|comment-list|content"
             }
         });
        </script>
<script src="../js/toc.js"></script>
<script src="../../www.gstatic.com/firebasejs/3.8.0/firebase.js"></script>
<script>
         let postCommentURL = '../api/post/vim-setup-2019.json';
         // Initialize Firebase
         var config = {
             apiKey: "AIzaSyA1PnIAlJJ-U6iQJMNnCOknBuziBqGMYcY",
             authDomain: "huys-blog-comment.firebaseapp.com",
             databaseURL: "https://huys-blog-comment.firebaseio.com",
             projectId: "huys-blog-comment",
             storageBucket: "huys-blog-comment.appspot.com",
             messagingSenderId: "317330376829"
         };

         var login = function() {
             window.auth.signInWithPopup(provider)
                   .then(function(result) {
                   }).catch(function(err) {
                   });
         };

         var goninja = function() {
             updateAuth({
                 displayName: "Không Tên",
                 photoURL: "https://thefullsnack.com/img/kaonashi.jpg"
             });
         };

         var updateAuth = function(user) {
             if (user) {
                 currentUser = user;
                 // Logged in
                 document.getElementById("login-box").style.display = "none";
                 document.getElementById("comment-box").style.display = "flex";
                 document.getElementById("user-avatar").setAttribute("src", user.photoURL + "?sz=32");
             } else {
                 // Not login yet
                 document.getElementById("comment-box").style.display = "none";
                 document.getElementById("login-box").style.display = "block";
             }
         };

         var encodeHTML = function(s) {
             return s.replace(/</g, '&lt;').replace(/"/g, '&quot;').replace(/>/g, '&gt;');
         };

         var saveNewComment = function(comment) {
             if (!currentUser) {
                 return;
             }
             var commentData = {
                 username: currentUser.displayName,
                 avatar: currentUser.photoURL,
                 post_time: ~~((new Date()).getTime() / 1000),
                 message: encodeHTML(comment)
             };

             fetch(postCommentURL, {
                 method: 'post',
                 headers: {
                     "Content-Type": "application/json"
                 },
                 body: JSON.stringify(commentData)
             }).then((result) => {
                 if (result.status === 200) {
                     addNewComment(commentData.username, commentData.avatar, commentData.post_time, commentData.message);
                 }
             });

             document.getElementById("comment-content").value = "";
         };

         function debounce(func, wait, immediate) {
             var timeout;
             return function() {
                 var context = this, args = arguments;
                 var later = function() {
                     timeout = null;
                     if (!immediate) func.apply(context, args);
                 };
                 var callNow = immediate && !timeout;
                 clearTimeout(timeout);
                 timeout = setTimeout(later, wait);
                 if (callNow) func.apply(context, args);
             };
         };

         var submitData = debounce(function() {
             var comment = document.getElementById("comment-content").value;
             if (comment.length) {
                 saveNewComment(comment);
             }
         }, 250);

         var submitComment = function(e) {
             var keyCode = e.which || e.keyCode;
             var ctrlCode = e.ctrlKey || e.metaKey;
             if (keyCode === 13 && ctrlCode) {
                 submitData();
             }
         };

         var filterNewlineInComment = function(t) {
             return t.replace(/\n/g, "<br/>");
         };

         var filterURLinComment = function(comment) {
             return comment.replace(/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9]\.[^\s]{2,})/g, "<a target='_blank' rel='noopener noreferrer' href='$1'>$1</a>");
         };

         var addNewComment = function(user, avatar, time, comment, first) {
             var commentFiltered = encodeHTML(comment);
             commentFiltered = filterNewlineInComment(filterURLinComment(commentFiltered));
             commentFiltered = commentFiltered.replace(/```/g, '');
             var d = new Date(time * 1000);
             var commentTime = d.toLocaleTimeString() + ' ' + d.toLocaleDateString();
             var anoNameClass = (avatar.indexOf('thefullsnack.com') !== -1) ? "grey" : "";
             var html = '<div class="avatar">' +
                        '   <img src="' + avatar + '?sz=32" width="32" height="32"/>' +
                        ' </div>' +
                        '<div class="comment">' +
                        '  <div class="metadata"><b class="' + anoNameClass + '">' + encodeHTML(user) + '</b> lúc <span>' + commentTime + '</span></div>' +
                        '  <div class="content tex2jax_ignore">' + commentFiltered
             '  </div>' +
                        '</div>';
             var li = document.createElement('li');
             li.innerHTML = html;
             if (!first) {
                 document.getElementById("comment-list").append(li);
             } else {
                 let elm = document.getElementById("comment-list");
                 elm.insertBefore(li, elm.firstChild);
             }
         };



         window.onload = function() {

             document.querySelectorAll("pre code").forEach(el => {
                 hljs.highlightBlock(el);
             });

             start_toc_module();

             firebase.initializeApp(config);
             window.provider = new firebase.auth.GoogleAuthProvider();
             window.auth = firebase.auth();
             window.currentUser = null;

             window.auth.onAuthStateChanged(function(user) {
                 updateAuth(user);
             });


             // Fetch comment and put to posts
             fetch(postCommentURL)
                 .then(res => res.json())
                 .then(data => {
                     if (data.comments) {
                         let comments = data.comments;
                         comments.sort((a, b) => a.post_time - b.post_time);
                         for (let i = 0; i < comments.length; i++) {
                             let cmt = comments[i];
                             addNewComment(cmt.username, cmt.avatar, cmt.post_time, cmt.message);
                         }
                     }
                 });
         };

         var toggle_wordwise = function(status) {
             var book = document.querySelector("book");
             var on = document.querySelector("#ww_on");
             var off = document.querySelector("#ww_off");
             if (!status) {
                 book.className = "off";
                 on.className = "btn-toggle";
                 off.className = "btn-toggle active";
             } else {
                 book.className = "";
                 on.className = "btn-toggle active";
                 off.className = "btn-toggle";
             }
         };
        </script>
</body>

<!-- Mirrored from thefullsnack.com/posts/vim-setup-2019.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 May 2020 03:19:08 GMT -->
</html>
